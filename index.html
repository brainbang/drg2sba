<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Drg2sba : Extract sbagen &amp; meta-files from idoser DRG files in javascript">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
    <style>
    .btn-file {
        position: relative;
        overflow: hidden;
    }
    .btn-file input[type=file] {
        position: absolute;
        top: 0;
        right: 0;
        min-width: 100%;
        min-height: 100%;
        font-size: 100px;
        text-align: right;
        filter: alpha(opacity=0);
        opacity: 0;
        outline: none;
        background: white;
        cursor: inherit;
        display: block;
    }
    </style>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <title>drg2sba</title>
  </head>

  <body>

  <div class="jumbotron">
    <div class="container">
      <h1>drg2sba</h1>
    </div>
  </div>

  <div id="content" class="container">
    <p>Choose your DRG file to get the SBAGen-compatabile source of it.</p>
    
    <span class="btn-file btn btn-lg btn-default ">
      Choose DRG
      <input onchange="handleFiles(this.files)" type="file">
    </span>
  </div>    

  <script src="https://rawgit.com/konsumer/drg2sba/master/dist/drg2sba.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/yepnope/1.5.4/yepnope.min.js"></script>
  <script>
  yepnope([
    {
      test: window.atob,
      nope: 'https://bitbucket.org/davidchambers/base64.js/raw/47ecaff13726/base64.min.js',
    },
    {
      test: window.FileReader,
      nope: 'https://rawgit.com/MrSwitch/dropfile/master/dropfile.js',
    }
  ]);

  function openFile(file){
    var reader = new FileReader();
    reader.onload = function(e){
      var sba = drg2sba(atob(e.target.result.replace('data:;base64,','')).toString('binary'));
      window.open('data:text/plain,' + encodeURIComponent('## ' + sba.title + '\n##\n## ' + sba.description.split('\n').join('\n## ') + '\n\n' + sba.sbagen));
    };
    reader.readAsDataURL(file);
  }

  function handleFiles(files){
    var l = files.length;
    for (var i=0;i<l;i++){
      openFile(files[i]);
    }
  }
  </script>
  </body>
</html>
